<!DOCTYPE html>
<html lang="en-us">
    
<head>
    <meta charset="UTF-8">
    <title>House Sorting</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <!-- jQuery -->
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <!-- Compiled and minified CSS -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css">
    <!-- Compiled and minified JavaScript -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js"></script>
    <!-- Font Awesome icons -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.1/css/font-awesome.min.css">
    <!-- Custom CSS -->
    <link rel="stylesheet" href="../styles/quizstyle.css">
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css?family=Beth+Ellen&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=Homemade+Apple&display=swap" rel="stylesheet">
</head>

<body>

    <div class="row">
        <div class="col m12">
            <div class="card z-depth-3 quiz-card">
                <div class="card-content white-text">
                    <h1 class="center-align quiz-title">Which house do you belong to?</h1>
                </div>
            </div>
        </div>
    </div>

    <div class="container">
        
        <form>
             <!-- Question 1 -->
            <label for="q1" class="question">Where are you most likely to be found on a Saturday night?</label><br>
            <div id="q1">
                <p>
                    <label>
                        <input value="2" class="with-gap" name="group1" type="radio"/>
                        <span id="poss-answers">Studying for upcoming exams</span>
                    </label>
                </p>
                <p>
                    <label>
                        <input value="4" class="with-gap" name="group1" type="radio"/>
                        <span id="poss-answers">Hiding stink bombs in the girls' dormitories</span>
                    </label>
                </p>
                <p>
                    <label>
                        <input value="1" class="with-gap" name="group1" type="radio"/>
                        <span id="poss-answers">Sneaking into the Enchanted Forest on a dare</span>
                    </label>
                </p>
                <p>
                    <label>
                        <input value="3" class="with-gap" name="group1" type="radio"/>
                        <span id="poss-answers">Drinking Butterbeer with your friends</span>
                    </label>
                </p>
            </div>
            <!-- Question 2 -->
            <label for="q2" class="question">Which pet would you choose as your companion?</label><br>
            <div id="q2">
                <p>
                    <label>
                        <input value="1" class="with-gap" name="group2" type="radio"/>
                        <span id="poss-answers">A cat</span>
                    </label>
                </p>
                <p>
                    <label>
                        <input value="3" class="with-gap" name="group2" type="radio"/>
                        <span id="poss-answers">A rabbit</span>
                    </label>
                </p>
                <p>
                    <label>
                        <input value="4" class="with-gap" name="group2" type="radio"/>
                        <span id="poss-answers">A snake</span>
                    </label>
                </p>
                <p>
                    <label>
                        <input value="2" class="with-gap" name="group2" type="radio"/>
                        <span id="poss-answers">A crow</span>
                    </label>
                </p>
            </div>
            <!-- Question 3 -->
            <label for="q3" class="question">Which class are you most looking forward to?</label><br>
            <div id="q3">
                <p>
                    <label>
                        <input value="1" class="with-gap" name="group3" type="radio"/>
                        <span id="poss-answers">Defense Against the Dark Arts</span>
                    </label>
                </p>
                <p>
                    <label>
                        <input value="2" class="with-gap" name="group3" type="radio"/>
                        <span id="poss-answers">History of Magic</span>
                    </label>
                </p>
                <p>
                    <label>
                        <input value="4" class="with-gap" name="group3" type="radio"/>
                        <span id="poss-answers">Potions</span>
                    </label>
                </p>
                <p>
                    <label>
                        <input value="3" class="with-gap" name="group3" type="radio"/>
                        <span id="poss-answers">Charms</span>
                    </label>
                </p>
            </div>
            <!-- Question 4 -->
            <label for="q4" class="question">You notice someone cheating on their O.W.L.s by using an Auto-Answer Quill! Do you:</label><br>
            <div id="q4">
                <p>
                    <label>
                        <input value="1" class="with-gap" name="group4" type="radio"/>
                        <span id="poss-answers">Ignore them. You have your own test to worry about.</span>
                    </label>
                </p>
                <p>
                    <label>
                        <input value="4" class="with-gap" name="group4" type="radio"/>
                        <span id="poss-answers">Lean over and copy their answers for an easy "O" score.</span>
                    </label>
                </p>
                <p>
                    <label>
                        <input value="2" class="with-gap" name="group4" type="radio"/>
                        <span id="poss-answers">Wave down a professor.</span>
                    </label>
                </p>
                <p>
                    <label>
                        <input value="3" class="with-gap" name="group4" type="radio"/>
                        <span id="poss-answers">Talk to them after and try to help them change.</span>
                    </label>
                </p>
            </div>
            <!-- Question 5 -->
            <label for="q5" class="question">You are wandering the halls of Hogwarts at night and stumble upon the Mirror of Erised. What do you see?</label><br>
            <div id="q5">
                <p>
                    <label>
                        <input value="4" class="with-gap" name="group5" type="radio"/>
                        <span id="poss-answers">Yourself surrounded by piles of Galleons</span>
                    </label>
                </p>
                <p>
                    <label>
                        <input value="3" class="with-gap" name="group5" type="radio"/>
                        <span id="poss-answers">A party with your closest friends</span>
                    </label>
                </p>
                <p>
                    <label>
                        <input value="1" class="with-gap" name="group5" type="radio"/>
                        <span id="poss-answers">An older version of yourself with your loving family</span>
                    </label>
                </p>
                <p>
                    <label>
                        <input value="2" class="with-gap" name="group5" type="radio"/>
                        <span id="poss-answers">Yourself reading a book in your private library</span>
                    </label>
                </p>
            </div>
            <!-- Question 6 -->
            <label for="q6" class="question">You notice a group of Fifth Years picking on a fellow First Year. What do you do?</label><br>
            <div id="q6">
                <p>
                    <label>
                        <input value="1" class="with-gap" name="group6" type="radio"/>
                        <span id="poss-answers">Step in between them, breaking it up</span>
                    </label>
                </p>
                <p>
                    <label>
                        <input value="4" class="with-gap" name="group6" type="radio"/>
                        <span id="poss-answers">Join in the fun. You don't like him either!</span>
                    </label>
                </p>
                <p>
                    <label>
                        <input value="2" class="with-gap" name="group6" type="radio"/>
                        <span id="poss-answers">Find a professor to help</span>
                    </label>
                </p>
                <p>
                    <label>
                        <input value="2" class="with-gap" name="group6" type="radio"/>
                        <span id="poss-answers">Seek out the student later and try to console him</span>
                    </label>
                </p>
            </div>
            <!-- Question 7 -->
            <label for="q7" class="question">A fire has broken out in your dormitory and you can only save one thing. What do you take?</label><br>
            <div id="q7">
                <p>
                    <label>
                        <input value="1" class="with-gap" name="group7" type="radio"/>
                        <span id="poss-answers">Your pet</span>
                    </label>
                </p>
                <p>
                    <label>
                        <input value="2" class="with-gap" name="group7" type="radio"/>
                        <span id="poss-answers">Your favorite book</span>
                    </label>
                </p>
                <p>
                    <label>
                        <input value="3" class="with-gap" name="group7" type="radio"/>
                        <span id="poss-answers">Your family photo album</span>
                    </label>
                </p>
                <p>
                    <label>
                        <input value="4" class="with-gap" name="group7" type="radio"/>
                        <span id="poss-answers">Your lockbox containing valuables</span>
                    </label>
                </p>
            </div>
            <!-- Question 8 -->
            <label for="q8" class="question">It's Hogsmeade weekend. Where do you and your friends go?</label><br>
            <div id="q8">
                <p>
                    <label>
                        <input value="4" class="with-gap" name="group8" type="radio"/>
                        <span id="poss-answers">The Shrieking Shack to try and find a way inside</span>
                    </label>
                </p>
                <p>
                    <label>
                        <input value="1" class="with-gap" name="group8" type="radio"/>
                        <span id="poss-answers">Honeydukes to relax with some friends</span>
                    </label>
                </p>
                <p>
                    <label>
                        <input value="2" class="with-gap" name="group8" type="radio"/>
                        <span id="poss-answers">Tomes and Scrolls for some new books</span>
                    </label>
                </p>
                <p>
                    <label>
                        <input value="3" class="with-gap" name="group8" type="radio"/>
                        <span id="poss-answers">Zonko's Joke Shop for some gag gifts</span>
                    </label>
                </p>
            </div>
            <!-- Question 9 -->
            <label for="q9" class="question">You find yourself in a duel with a rival wizard. What is the first spell you cast?</label><br>
            <div id="q9">
                <p>
                    <label>
                        <input value="1" class="with-gap" name="group9" type="radio"/>
                        <span id="poss-answers">Expelliarmus</span>
                    </label>
                </p>
                <p>
                    <label>
                        <input value="3" class="with-gap" name="group9" type="radio"/>
                        <span id="poss-answers">A Bat-Bogey Hex</span>
                    </label>
                </p>
                <p>
                    <label>
                        <input value="4" class="with-gap" name="group9" type="radio"/>
                        <span id="poss-answers">Crucio</span>
                    </label>
                </p>
                <p>
                    <label>
                        <input value="2" class="with-gap" name="group9" type="radio"/>
                        <span id="poss-answers">Full Body-Bind Curse</span>
                    </label>
                </p>
            </div>
            <!-- Question 10 -->
            <label for="q10" class="question">What position do you play on the Quidditch team?</label><br>
            <div id="q10">
                <p>
                    <label>
                        <input value="1" class="with-gap" name="group10" type="radio"/>
                        <span id="poss-answers">Seeker</span>
                    </label>
                </p>
                <p>
                    <label>
                        <input value="4" class="with-gap" name="group10" type="radio"/>
                        <span id="poss-answers">Beater</span>
                    </label>
                </p>
                <p>
                    <label>
                        <input value="2" class="with-gap" name="group10" type="radio"/>
                        <span id="poss-answers">Chaser</span>
                    </label>
                </p>
                <p>
                    <label>
                        <input value="3" class="with-gap" name="group10" type="radio"/>
                        <span id="poss-answers">Keeper</span>
                    </label>
                </p>
            </div>
            <br>
            <button class="btn waves-effect waves-light brown darken-2" id="submit" type="submit"> Submit</button>
        </form>
        <br>

        <!-- Form validation modal -->
        <div id="modal1" class="modal">
            <div class="modal-content">
                <h4 class="center-align modalv">Locomotor Mortis!</h4>
                <br><br>
                <p class="center-align modalv">Please answer all of the questions.</p>
            </div>
            <div class="modal-footer" id="modal1-footer">
                <a href="#!" class="modal-close waves-effect waves-brown btn-flat modalv">Got it!</a>
            </div>
        </div>
        <!-- Match modal -->
        <div class="modal" id="modal-match">
            <div class="modal-content">
                <div class="modal-header">
                    <h4 class="center-align modalm">You've been sorted into...</h4>
                </div>
                <div class="modal-body">
                    <p class="center-align modalm"><span id="match-name"></span>!</p>
                    <img class="responsive-img center-align" id="match-photo" src="" alt="">
                </div>
            </div>
            <div class="modal-footer">
                <a href="/quiz2" class="modal-close waves-effect waves-brown btn-flat modalm">Next Quiz!</a>
            </div>
        </div>
        

    </div>

<!--- audio -->
<audio id="gryffindor-noise">
    <source src="../audio/gryffindor-noise.mp3" type="audio/mpeg">
</audio>    
<audio id="hufflepuff-noise">
    <source src="../audio/hufflepuff-noise.mp3" type="audio/mpeg">
</audio>    
<audio id="ravenclaw-noise">
    <source src="../audio/ravenclaw-noise.mp3" type="audio/mpeg">
</audio>   
<audio id="slytherin-noise">
    <source src="../audio/slytherin-noise.mp3" type="audio/mpeg">
</audio>   
<audio id="sorting-hat-start">
    <source src="../audio/sorting-hat-start.mp3" type="audio/mpeg">
</audio>   

<script type="text/javascript">
    
// var playerName = JSON.parse(sessionStorage.getItem("playerName"));
// console.log(playerName);

$( document ).ready(function() {
    $('audio#sorting-hat-start')[0].play();
    // setTimeout(song, 12000)
    // function song(){
    // $('audio#sorting-hat-song')[0].play();    
    // }
});

// Retrieve user input
$("#submit").on("click", function(event) {
    var answerArr = [];
    var userAnswers = {};
    event.preventDefault();
    // Form validation
    function validateForm() {
        var isValid = true;

        userAnswers = {
          hello: ["hello"],
          options: [
            $("#q1 input:checked").val(),
            $("#q2 input:checked").val(),
            $("#q3 input:checked").val(),
            $("#q4 input:checked").val(),
            $("#q5 input:checked").val(),
            $("#q6 input:checked").val(),
            $("#q7 input:checked").val(),
            $("#q8 input:checked").val(),
            $("#q9 input:checked").val(),
            $("#q10 input:checked").val()
          ]
        };
        console.log("GOODBYE");
        console.log(userAnswers);
        
        userAnswers.options.map(i=>{
            if($(`#q${i} input:checked`)){
                answerArr.push(i)
            } 
            if (answerArr.includes(undefined)) {
                isValid = false;
            }
        })
        console.log(answerArr);
        console.log("Form validation finished");
        return isValid;
    }
    
    // If form validation returns as true, create an object to hold user's input
    if (validateForm()) {
        console.log("HELLO");
        console.log(userAnswers);
        var playerID = sessionStorage.getItem("playerID");
        console.log(playerID);
        // Post user input to /api/players
        $.ajax({
            method: "PUT",
            url: "/api/players",
            data: {userAnswers, playerID}
        })
        .then(function(data){
            // Grab match here
            $("#match-name").text(data.houseName);
            $("#match-photo").attr("src", data.houseImage);

            if (data.houseName === "Gryffindor") {
                $("audio#gryffindor-noise")[0].play();
            }
            else if (data.houseName === "Hufflepuff") {
                $("audio#hufflepuff-noise")[0].play();
            }
            else if (data.houseName === "Ravenclaw") {
                $("audio#ravenclaw-noise")[0].play();
            }
            else if (data.houseName === "Slytherin") {
                $("audio#slytherin-noise")[0].play();
            };

            // Show results modal
            $("#modal-match").modal({
                dismissible: false
            });
            $("#modal-match").modal("open");
            console.log("Front end hello!");
        })
        // .then(() => {  
        //     $.post("/results", playerName, function(data) {
        //         console.log(playerName);
        //     })
        // })
        // .then(() => {
        //     window.location.href = "/results"
        // });
    
    } 
    // If form validation returns as false, tell the user to fill out all of the questions
    else {
        $("#modal1").modal();
        $("#modal1").modal("open");
    }
});

$("#q1 input").on("click", function() {
    console.log($("#q1 input:checked").val());
})

</script>

</body>

</html>